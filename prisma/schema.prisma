// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - stores customer information
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  fullName      String
  contactNo     String?
  vehicleNumber String?
  nic           String?   @unique
  role          Role      @default(CUSTOMER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  bookings      Booking[]
  ownedLocations ParkingLocation[] @relation("ParkingLocationOwner")

  @@map("users")
}

enum Role {
  ADMIN
  CUSTOMER
  COUNTER
  LAND_OWNER
  WASHER
}

// Parking Location Status enum
enum ParkingLocationStatus {
  ACTIVATED
  NOT_ACTIVATED
}

// Parking Location model - different parking areas
model ParkingLocation {
  id           String                @id @default(cuid())
  name         String
  address      String
  description  String?
  totalSlots   Int
  pricePerHour Float                 @default(300)
  pricePerDay  Float                 @default(2000)
  status       ParkingLocationStatus @default(NOT_ACTIVATED)
  ownerId      String?
  owner        User?                 @relation("ParkingLocationOwner", fields: [ownerId], references: [id], onDelete: SetNull)
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  slots        ParkingSlot[]

  @@map("parking_locations")
}

// Parking Slot model - individual parking spaces
model ParkingSlot {
  id           String          @id @default(cuid())
  number       String
  zone         String          @default("A")
  type         SlotType        @default(NORMAL)
  status       SlotStatus      @default(AVAILABLE)
  pricePerHour Float           @default(300)
  locationId   String
  location     ParkingLocation @relation(fields: [locationId], references: [id], onDelete: Cascade)
  bookings     BookingSlot[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@unique([locationId, number])
  @@map("parking_slots")
}

enum SlotType {
  NORMAL
  EV
  CAR_WASH
}

enum SlotStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
}

// Booking model - parking reservations
model Booking {
  id          String        @id @default(cuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  date        DateTime
  startTime   DateTime
  endTime     DateTime
  duration    Int           // in hours
  totalAmount Float
  paidAmount  Float         @default(0)
  status      BookingStatus @default(PENDING)
  slots       BookingSlot[]
  payment     Payment?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@map("bookings")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  PAID
  COMPLETED
  CANCELLED
}

// Junction table for Booking and ParkingSlot (many-to-many)
model BookingSlot {
  id        String      @id @default(cuid())
  bookingId String
  booking   Booking     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  slotId    String
  slot      ParkingSlot @relation(fields: [slotId], references: [id], onDelete: Cascade)

  @@unique([bookingId, slotId])
  @@map("booking_slots")
}

// Payment model - payment records
model Payment {
  id            String        @id @default(cuid())
  bookingId     String        @unique
  booking       Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  amount        Float
  method        PaymentMethod @default(CARD)
  status        PaymentStatus @default(PENDING)
  transactionId String?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("payments")
}

enum PaymentMethod {
  CARD
  CASH
  ONLINE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// ==========================================
// WASHER DASHBOARD MODELS
// ==========================================

// Washer Customer model - stores customer information for car wash services
model WasherCustomer {
  id               String           @id @default(cuid())
  name             String
  email            String           @unique
  phone            String
  vehicleDetails   String           // e.g., "Toyota Camry 2020 - Black"
  otherRelevantInfo String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  bookings         WasherBooking[]

  @@map("washer_customers")
}

// Washer Booking Status enum
enum WasherBookingStatus {
  PENDING
  ACCEPTED
  COMPLETED
  CANCELLED
}

// Washer Booking model - car wash service bookings
model WasherBooking {
  id          String              @id @default(cuid())
  customerId  String
  customer    WasherCustomer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  slotTime    DateTime
  vehicle     String              // Vehicle description for this specific booking
  serviceType String              // e.g., "Car Wash", "Full Detail", "Quick Wash", "Interior Clean"
  status      WasherBookingStatus @default(PENDING)
  notes       String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  @@map("washer_bookings")
}

// Washer Notification model - for tracking alerts and notifications
model WasherNotification {
  id        String   @id @default(cuid())
  type      String   // 'new_booking', 'urgent_reminder', 'upcoming_slot'
  message   String
  bookingId String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("washer_notifications")
}

// ==========================================
// ADMIN PANEL MODELS
// ==========================================

// Admin Property Status enum
enum AdminPropertyStatus {
  ACTIVATED
  DEACTIVATED
}

// Admin Property model - stores parking area properties for admin management
model AdminProperty {
  id            String              @id @default(cuid())
  propertyName  String
  location      String
  description   String?
  pricePerHour  Float               @default(300)
  status        AdminPropertyStatus @default(ACTIVATED)
  totalSlots    Int                 @default(0)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  slots         AdminParkingSlot[]
  bookings      AdminBooking[]

  @@map("admin_properties")
}

// Admin Parking Slot Status enum
enum AdminSlotStatus {
  AVAILABLE
  BOOKED
  DISABLED
}

// Admin Parking Slot model - individual parking slots for admin properties
model AdminParkingSlot {
  id         String          @id @default(cuid())
  propertyId String
  property   AdminProperty   @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  slotNumber String
  status     AdminSlotStatus @default(AVAILABLE)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  bookings   AdminBooking[]

  @@unique([propertyId, slotNumber])
  @@map("admin_parking_slots")
}

// Admin Booking Status enum
enum AdminBookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

// Admin Booking model - booking records for admin panel
model AdminBooking {
  id          String             @id @default(cuid())
  propertyId  String
  property    AdminProperty      @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  slotId      String
  slot        AdminParkingSlot   @relation(fields: [slotId], references: [id], onDelete: Cascade)
  customerId  String
  customer    AdminCustomer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  bookingDate DateTime
  startTime   DateTime
  endTime     DateTime
  totalPrice  Float
  status      AdminBookingStatus @default(PENDING)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  @@map("admin_bookings")
}

// Admin Customer model - stores customer information for admin panel
model AdminCustomer {
  id             String         @id @default(cuid())
  name           String
  email          String         @unique
  phone          String
  registeredDate DateTime       @default(now())
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  bookings       AdminBooking[]

  @@map("admin_customers")
}
